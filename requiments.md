Техническое задание (ТЗ)

Проект: Локальная веб-страница (Single Page) для заполнения формы с предварительным просмотром и экспортом в PDF.

Краткое описание: одностраничное приложение, которое запускается локально (открывается в браузере как file:// ). Пользователь заполняет форму (можно частями в течение дня), сохраняет черновик, переходит к предварительному просмотру, при желании возвращается и редактирует, и в конце экспортирует результат в PDF. Данные сохраняются локально и сохраняются до тех пор, пока пользователь не нажмёт кнопку Отправить / Завершить (или явную «Очистить»).

Цели и требования
Цели

Обеспечить удобный UX для поэтапного заполнения формы.

Позволить сохранять незавершённые данные локально и восстанавливать их при повторном заходе.

Показывать точный предварительный просмотр перед генерацией PDF.

Генерировать качественный PDF, максимально похожий на предпросмотр.

Поддерживать возврат на шаги для редактирования.

Ограничения

Приложение должно работать локально .

Работает в браузере Chrome.

Ограничение размера локального хранилища (localStorage ~5MB) — для больших данных использовать IndexedDB.

Функциональные требования

Форма(ы)

Набор полей (текст, textarea, даты, чекбоксы, радиокнопки, select, при необходимости загрузка изображений/файлов).

Валидация полей (обязательные поля, формат дат, ограничения длины).

Многошаговый интерфейс

Кнопки Далее / Назад для переходов между шагами.

Индикатор текущего шага.

Предварительный просмотр

Страница предпросмотра, где данные отображаются в том виде, в котором будут в PDF.

Кнопки Редактировать (возврат на соответствующий шаг), Сохранить (сохранить черновик), Экспорт в PDF, Отправить/Завершить.

Сохранение черновика

Кнопка Сохранить черновик сохраняет текущее состояние формы в локальное хранилище.

Автосохранение (опционально) при изменении полей с настраиваемой задержкой (debounce).

При загрузке страницы — обнаружение существующего незавершённого черновика и предложение восстановить.

Генерация PDF

Экспорт предпросмотра в PDF-файл с корректным форматированием и разделением по страницам при необходимости.

Варианты: создать PDF клиент-стороной (без сервера).

Хранить метаданные: время сохранения, статус (черновик/отправлен), уникальный id. Позволяет иметь несколько черновиков (опционально).

Отмена / Очистка

Возможность удалить черновик или сбросить форму.

Локализация/язык — интерфейс на русском (возможна поддержка других языков).

Нефункциональные требования

UX: простой, понятный интерфейс; доступность (A11y) — метки, фокус, клавиатурная навигация.

Производительность: быстрая загрузка и отзывчивость, минимальная задержка при автосохранении.

Надёжность: восстановление данных после перезагрузки браузера.

Совместимость: современные настольные браузеры.

Безопасность/приватность: данные остаются локально по умолчанию; если реализовать опциональную синхронизацию — уведомлять пользователя.

UX / пользовательские сценарии
Сценарий 1 — Заполнение и экспорт за один сеанс

Открыть страницу.

Заполнить шаги формы, Далее до предпросмотра.

На предпросмотре нажать Экспорт в PDF — получить файл.

Сценарий 2 — Частичное заполнение и восстановление

Открыть страницу, заполнить часть полей.

Нажать Сохранить (или автосохранение произошло автоматически).

Закрыть браузер.

Через некоторое время открыть страницу — появится предложение восстановить черновик.

Восстановить и продолжить.

Сценарий 3 — Предпросмотр и правка

После заполнения перейти на предпросмотр.

Найти опечатку — нажать Редактировать (или Назад) на соответствующий шаг.

Исправить, вернуться на предпросмотр и экспортировать.

Технические решения и рекомендации
Стек технологий (минимальный, для локального SPA)

HTML5 + CSS3 + Vanilla JS (ES6+) — для простоты развёртывания (один файл или 3 файла).

Опционально: React/Vue/Svelte — если планируется масштабирование или сложная логика.

Хранение данных локально

localStorage — просто использовать для небольших форм (строки, JSON, до ~5MB). Простота: синхронный API.

IndexedDB — для больших объёмов (изображения, вложения) и более структурированных данных. Асинхронный, более гибкий.

File System Access API (опционально, Chrome/Edge) — позволяет открывать/сохранять файлы локально с диалогом ОС.

Рекомендация: начать с localStorage и обеспечить абстракцию хранилища (StorageAdapter), чтобы при необходимости переключиться на IndexedDB.

Автосохранение

Debounce (например 500–1500 ms) на input/change событий.

Пометка "сохранено" / "сохранение..." в UI.

Генерация PDF (клиентская сторона)

Опции библиотек:

html2pdf.js (в основе — html2canvas + jsPDF) — прост в использовании: преобразует HTML в canvas, затем в PDF. Плюс: быстро начать.

jsPDF + html2canvas — гибкость и контроль над размером страницы, подход для простых макетов.

pdf-lib — генерирует PDF «программно», больше контроля над страницами, шрифтами, но сложнее верстать WYSIWYG.

Print-to-PDF (window.print) — самое простое: подготовить CSS для печати и вызвать window.print(); пользователь сохранит как PDF через встроенную диалоговую систему. Минус: зависит от браузера/печати.

Рекомендация: использовать html2pdf.js или связку html2canvas + jsPDF для первого релиза. Для наилучшей типографики и контроля — рассмотреть pdf-lib (но потребует больше ручной верстки).

Обработка изображений / вложений

Для пользовательских загруженных изображений: конвертировать в dataURL и хранить в IndexedDB (или localStorage для маленьких картинок, но может быстро исчерпать лимит).

При экспорте в PDF — вставлять изображения в тот же макет предпросмотра.

Разбиение на страницы и контроль переносов

Верстка предпросмотра в контейнер с фиксированной шириной, соответствующей размеру страницы (например, A4 в px при 96dpi: 794×1123, но лучше рассчитывать в mm и использовать html2pdf настройки).

Обрабатывать разрывы страниц CSS-классами (page-break-inside: avoid;), и тестировать на длинных блоках.

Структура данных (пример)
{
  "id": "draft-20250823-001",
  "status": "draft", // draft | submitted
  "createdAt": "2025-08-23T10:00:00Z",
  "updatedAt": "2025-08-23T11:00:00Z",
  "currentStep": 2,
  "form": {
    "fullName": "Иван Иванов",
    "email": "ivan@example.com",
    "birthDate": "1990-01-01",
    "notes": "...",
    "attachments": [ {"name":"photo.png","dataUrl":"data:image/png;base64,..."} ]
  }
}
UI: примерная разбивка на экраны

Главный экран / Загрузка — проверяет наличие черновиков, предлагает восстановить или начать новый.

Шаги формы — визуальный прогресс, поля, Далее/Назад.

Предпросмотр — отображение финального макета, кнопки Редактировать, Сохранить, Экспорт в PDF, Отправить.

Модальные окна — подтверждение очистки, ошибки экспорта, уведомления об автосохранении.

Тестовые сценарии и критерии приёмки

При закрытии и повторном открытии страницы незавершённые данные восстанавливаются.

При экспорте PDF внешний вид совпадает с предпросмотром в пределах допустимых отличий.

Валидация обязательных полей блокирует переход на предпросмотр.

При автосохранении пользователь видит уведомление.

Удаление черновика удаляет все связанные данные.

Что вы, возможно, упустили (риск-перечень / идеи для расширения)

Работа с изображениями — размеры, сжатие, хранение (localStorage быстро исчерпает лимит).

Печать и разрывы страниц — длинные таблицы/контейнеры могут неправильно разбиваться.

Шрифты — встроенные шрифты в PDF для корректного отображения кириллицы (нужны подгружаемые шрифты или шрифты в библиотеке PDF).

Безопасность/приватность — если данные чувствительные, подумать про шифрование локального хранилища или локальную авторизацию.

Кроссбраузерность File API — разная реализация в Safari/Firefox/Chrome.

Резервное копирование/экспорт черновиков — возможность выгрузить черновик в файл и импортировать обратно.

Мобильная версия — адаптация интерфейса для смартфонов.

Множественные черновики — возможность хранить несколько незавершённых документов.

Чек-лист для реализации (пошагово)

Создать макет (HTML/CSS) для формы и предпросмотра.

Написать логику шагов (Next/Back + валидация).

Сделать адаптер хранения (localStorage -> IndexedDB при необходимости).

Реализовать Сохранить + автосохранение с индикатором.

Сделать компонент предпросмотра и обеспечить соответствие макетам печати.

Подключить библиотеку для генерации PDF и протестировать разбиение страниц.

Тестирование во всех целевых браузерах; тестовые сценарии и исправление багов.

Документирование: README с инструкцией как открыть локально.

Примерная организация файлов
/index.html
/styles.css
/app.js
/storageAdapter.js
/pdfGenerator.js
/lib/html2pdf.bundle.min.js (опционально)
/assets/*
/README.md

Если нужно — могу подготовить:

Готовый одностраничный пример (index.html + styles.css + app.js) с реализацией шагов, сохранением в localStorage и экспортом в PDF (jsPDF/html2canvas) — файл можно открыть локально в браузере.

Шаблон предпросмотра для печати (CSS @media print) и пример конфигурации html2pdf.

Примеры тест-кейсов для ручного и автоматизированного тестирования.

Конец ТЗ.